# Perusrunko ja p√§√§toiminnallisuudet

T√§ss√§ vaiheessa aloitetaan sovelluksen kehitys ja dokumentoidaan etenemist√§ vaiheittain t√§h√§n dokumenttiin. 

## 2.1. Ymp√§rist√∂ ##

T√§ss√§ luvussa kuvaillaan k√§ytetty kehitysymp√§rist√∂ ja projektissa tarvittavien ohjelmien asennus. 
Projekti kehitet√§√§n aluksi omalla paikallisella koneella VSCodella ja siirret√§√§n Azuren pilvipalveluun my√∂hemmin, kun backend ja frontend ovat perusrakeenteeltaan valmiit.
Projektin kehitt√§misess√§ tarvitaan seuraavia ohjelmia: 
  - Node.js (+express) - Backendin ja frontendin ajamiseen
  - SQLite3 - Tietokanta
  - Git & GitHub - Versionhallintaan
  - VS Code - Koodieditori

  **Node.js** 

Node.js tarvitaan projektissa JavaScriptin ajamiseen ja se on t√§m√§n projektin backendin ja frontendin p√§√§ajoymp√§rist√∂. 
    - Asennetaan Node.js virallisilta sivuilta: https://nodejs.org/en
    - Ladattiin uusin versio (LTS) ja asennettiin oletusasetuksilla. 
    - Tarkistetaan asennus komentorivin kautta: node -v ja tarkistetaan, ett√§ komento palauttaa versionumeron.

  **SQLite**

P√§√§dyimme k√§ytt√§m√§√§n tietokannassa SQLite√§, koska meill√§ on pieni kahden hengen kehitystiimi ja ty√∂skentelemme p√§√§osin et√§n√§ omilla koneillamme.
Valitsemalla SQLiten varmistamme, ett√§ molemmat tiimin j√§senet p√§√§sev√§t helposti k√§siksi yhteiseen tietokantaan. 
Emme odota suuria k√§ytt√§j√§- tai tietom√§√§ri√§, joten emme tarvitse monimutkaista tietokantarakennetta projektin kehityksen t√§ss√§ vaiheessa.  

  - Asennettaan SQLite nettisivujen kautta: https://www.sqlite.org/download.html
  - Ladattiin ja asennettiin Windowsin versio sqlite-dll-win-x64-3490100.zip (64-bit DLL)
  - Tarkistetaan asennus komentorivin kautta: sqlite3 --version ja tarkistetaan, ett√§ komento palauttaa versionumeron.

**GitHub ja VSCode**

K√§yt√§mme projektin versionhallintaan yhteist√§ GitHub repositorya ja sovelluksen koodaamiseen VSCodea. Tiimin j√§senet p√§ivitt√§v√§t koodiin tehdyt muutokset GitHubiin, josta
muut j√§senet voivat hakea muutokset omaan kehitysymp√§rist√∂√∂ns√§ ja n√§in molempien koodi pysyy samassa vaiheessa. 

  - GitHub repon osoite: https://github.com/TaipaleMari/Web-kehitys-Projekti
  - kloonataan komennolla: git clone https://github.com/TaipaleMari/Web-kehitys-Projekti.git
  - siirryt√§√§n VSCodessa kloonattuun kansioon ja aloitetaan projektin koodin luominen.

*Edit* 15.4.2025 Siirto Azuren pilvipalvelimeen. Kloonattu t√§m√§n github-repossa master-haarassa sijaitseva sovellus. Sovellus on Azuressa k√§ynniss√§ ja saa p√§ivitykset (kts. alta kuvat). Sovelluksen pit√§isi toimia osoitteessa: [noma-react-app-exc6fsdmejc2eydy.westeurope-01.azurewebsites.net](https://noma-react-app-exc6fsdmejc2eydy.westeurope-01.azurewebsites.net/) 
Ongelmia viel√§ toistaiseksi koodissa, koska sovellus ei k√§ynnisty selaimessa oikein. 

![Sovellus_k√§ynniss√§](../Screenshot%202025-04-15%20145155.png)

![Sovelluksen_tiedot](../Screenshot%202025-04-15%20145216.png)


*Edit* 16.4.2025 Yritetty uudelleen Azureen siirtoa. T√§ll√§ kertaa tehty Azure Static WEb App ja api-kansio. Sovelluksen pit√§isi olla toiminnassa t√§√§ll√§: [white-sea-azurestaticapps.net](https://white-sea-0d1285e03.6.azurestaticapps.net)

![AzureStaticWebApp](../Screenshot%2025-04-16%111516.png)



## 2.2. Backend ##

T√§ss√§ luvussa on kuvattu backend kehityksen vaiheet VSCodessa. Lopuksi sovelluksen koodi on siirretty t√§h√§n GitHub projektirepoon, master-haaraan: https://github.com/TaipaleMari/Web-kehitys-Projekti.git  

Sovelluskansion sis√§√§n luotu erillinen backend kansio.  VSCoden terminaalissa on navigoitu backend kansioon ja alustetaan uusi Node.js-projekti oletusasetuksilla: ```npm init -y``` 

Asensimme kerralla tarvittavat npm paketit: ```install express sqlite3 bkryptjs jsonwebtoken cors dotenv```
- express = Noden web-sovelluskehys
- sqlite3 = tietokantak√§ytt√∂ Nodessa
- bcryptjs = salasanojen turvalliseen k√§ytt√∂√∂n salausfunktiot
- jsonwebtoken = autentikointia varten
- cors = Cross-Origin Resource Sharing -tuki (sallitaan ulkopuolisten verkkosivujen tehd√§ pyynt√∂j√§)
- dotenv = lataa ymp√§rist√∂muuttujia .env-tiedostosta


Backend-kansioon luotu server.js tiedosto ja tiedostoon lis√§tty koodi, joka sis√§lt√§√§ rekister√∂intireitin, testireitin, k√§ytt√§j√§tietokannan, kirjautumisreitin (sis√§lt√§√§ viestin jos salasana tai k√§ytt√§nimi virheellinen) sek√§ palvelimen k√§ynnistys (*kuuntelee porttia 5000;)

[server.js](https://github.com/TaipaleMari/Web-kehitys-Projekti/blob/master/backend/server.js)

Terminaaliin komento ```node server.js```, selaimella http://localhost:5000/ , saatu viesti selaimeen "backend toimii!"

Backend kansioon luotiin database-kansio ja sen sis√§√§n sqliten tietokanta tiedosto: database/users.db.
Backend kansioon tehtiin db.js -tiedosto, joka sis√§lt√§√§ tietokantayhteyden server.js tiedostoon. T√§m√§n j√§lkeen k√§ynnistettiin palvelin uudelleen testataksemme tietokantayhteyden toimivuuden, tarkoituksena saada terminaaliin viesti "yhdistetty sqlite tietokantaan".

K√§ytt√§j√§n rekister√∂inti: lis√§tty koodia server.js:n, joka mahdollistaa k√§ytt√§j√§n rekister√∂imisen. Testattu komentorivilt√§ rekister√∂inti√§: cURL-komennolla: ```curl -X POST http://localhost:5000/register \
    -H "Content-Type: application/json" \
    -d '{"username": "testuser", "email": "testuser@example.com", "password": "password123"}'```
    
*Muutettu kuuntelemaan porttia 3001 yhten√§ korjaus yrityksen√§ teht√§vien lis√§yksen ja tilan muuttamisen yhteydess√§.

## 2.3. Frontend ##

Frontendiss√§ haluamme k√§ytt√§j√§lle seuraavat toiminnallisuudet:
  - etusivulla sis√§√§nkirjautuminen ja linkki rekister√∂itymislomakkeelle
  - onnistuneen kirjautumisen j√§lkeen siirryt√§√§n k√§ytt√§j√§n omalle etusivulle, jossa listaus teht√§vist√§
  - teht√§vien merkkaaminen suoritetuksi, teht√§vien muokkaaminen ja lis√§√§minen

Frontend kansioon tehtiin register.js-tiedosto ja app.js-tiedosto. 

Terminaalissa annettiin komento: ```react-router-dom``` , joka lataa ja asentaa React-kirjaston. T√§m√§ mahdollistaa sovelluksen eri sivujen navigoinnin ilman, ett√§ koko sivu latautuu uudelleen.... tekee sovelluksestamme dynaamisemman k√§ytt√§√§. tarvitsemme t√§t√§ ominaisuutta, jotta k√§ytt√§j√§ voi joustavasti muokata omaa teht√§v√§tauluaan. 

Sovelluksen k√§ynnistyess√§ ensin aukeaa Home.js sivu, josta voi valita siirtymisen edelleen kirjautumiseen (login.js) tai rekister√∂itymiseen (register.js)

### Rekister√∂inti ###

[Register.js:n koodi](https://github.com/TaipaleMari/Web-kehitys-Projekti/blob/master/frontend/src/pages/Register.js)


### Kirjautuminen ###

Login.js ja yhteys backendiin, jossa varmistetaan, ett√§ k√§tt√§j√§ on rekister√∂itynyt ja ett√§ salasana t√§sm√§√§ k√§ytt√§j√§tunnuksen kanssa. 

[Login.js:n koodi ](https://github.com/TaipaleMari/Web-kehitys-Projekti/blob/master/frontend/src/pages/Login.js)

### K√§ytt√§j√§n sivu ### 

local storage - koodirivi userDashboard.js:ss√§ ja App.js:ss√§ mahdollistaa k√§ytt√∂tietojen s√§ilytt√§misen selaimessa. 

userDashboard.js sis√§lt√§√§ k√§ytt√§j√§n etusivun ja teht√§vien muokkauksen

[userDashboard.js:n koodi](https://github.com/TaipaleMari/Web-kehitys-Projekti/blob/master/frontend/src/pages/UserDashboard.js)


## 2.4. Tietokanta ##

Tietokantana sovelluksella toimii SQLite. Se on kevyt ja helppok√§ytt√∂inen ratkaisu paikalliseen kehitykseen. Tietokantaan k√§ytt√§jille luodaan taulu, jossa on seuraavat kent√§t:
  - id INTEGER PRIMARY KEY
  - username TEXT UNIQUE
  - email TEXT UNIQUE
  - password TEXT

Tietokantaan voidaan laajentaa lis√§kentti√§, kuten teht√§v√§t ja aikaleimat.
Tietokanta alustetaan automaattisesti db.js-tiedoston kautta, joka yhdistet√§√§n backendiin server.js:n.

## 2.5. Perusrakenne ja arkkitehtuuri ##

Backend koostuu: 
  - server.js, joka on sovelluksen p√§√§asiallinen palvelintiedosto. T√§m√§ m√§√§rittelee reitit ja k√§sittelee HTTP-pyynn√∂t
  - db.js, joka on tietokannan alustamiseen ja taulujen luontiin
  - routes/ , t√§m√§ on tulevia reittej√§ varten
  

Frontend koostuu:
   - App.js, t√§m√§ on p√§√§komponentti ja sis√§lt√§√§ reititykset
   - pages/, n√§iss√§ on rekister√∂inti, kirjautuminen, etusivu jne.

Sovelluksen kansiorakenne:


```text
üìÅ Master-haara
‚îú‚îÄ‚îÄ üìÅ backend
‚îÇ   ‚îú‚îÄ‚îÄüìÅ database
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ node_modules
‚îú‚îÄ‚îÄ üìÅ frontend
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ public
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ src
‚îÇ       ‚îú‚îÄ‚îÄ üìÅ pages
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ AddTasksForm.js
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Home.js
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Login.js
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Register.js
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ UserDashboard.js
‚îÇ       ‚îú‚îÄ‚îÄ App.js
‚îÇ       ‚îî‚îÄ‚îÄ App.css
‚îî‚îÄ‚îÄ README.md
```






## 2.6. Toiminnot ##

Sovelluskehityksen t√§ss√§ vaiheessa olemme toteuttaneet seuraavat toiminnallisuudet: 
  - K√§ytt√§j√§n rekister√∂inti ja kirjautuminen
  - JWT-autentikointi backendiss√§
  - K√§ytt√§j√§n teht√§vien hallinta: lis√§√§minen, muokkaaminen ja suoritetuksi merkkaaminen
  - LocalStorageen tallentaminen

N√§m√§ toiminnallisuudet on testattu ja ne toimivat odotetulla tavalla. Frontendin ja backendin v√§linen yhteys toimii JSON-pyynt√∂jen avulla. 

## 2.7. Testaus ja virheenk√§sittely ##

Virheenk√§sittely on toteutettu backendiin tarkistamalla 
1. onko k√§ytt√§j√§ olemassa
2. t√§sm√§√§k√∂ salasana
3. ovatko sy√∂tetyt kent√§t tyhji√§

Frontendiss√§ virheviestit ilmestyv√§t k√§ytt√§j√§lle n√§kyviin.
Testausta on suoritettu manuaalisesti selaimen kautta testaamalla, ett√§ toiminnot toimivat kuten pit√§√§ sek√§ komentorivin kautta cURL:illa.

Testattu backendin toimivuutta sek√§ SQLite konsolilla selaimesta (https://sqlite.org/fiddle/index.html) sek√§ Postman-ohjelmalla. Testauksien avulla saatu selville, ett√§ tietokantatiedosto on oikea ja sen polku t√§sm√§√§ sek√§ Backend kansiossa ett√§ SQL-konsolissa. Tietokantaan on saatu lis√§tty√§ onnistuneesti SQL-konsolin kautta tarvittavat sarakkeet ja n√§ihin tietojen lis√§ys onnistuu my√∂s konsolin kautta. N√§m√§ tarkistukset tehty ```PRAGMA table_info(tasks);``` ja ```INSERT INTO tasks...``` kyselyill√§. Lis√§ys tehty ```ALTER TABLE tasks ADD COLUMN completed BOOLEAN DEFAULT 0``` komennolla. Backendin yhteydess√§ kaikkia toivottuja sarakkeita ei kuitenkaan n√§y. T√§t√§ n√§kym√§√§ testattu lis√§√§m√§ll√§ ```console.log('Tasks-taulun rakenne:', rows);``` , joka antaa Backendin terminaaliin tiedot Tasks-taulun rakenteesta. Teht√§v√§n lis√§√§misen ja teht√§v√§n tilan muuttamisen selvitt√§misen yhteydess√§ lis√§tty muihinkin kohtiin ```console.log```, jotta saataisiin mahdollisimman hyvin tietoa, ett√§ miss√§ ongelma sijaitsee. Esimerkiksi lis√§tty Backend server.js tiedostoon my√∂s ```console.log('Tietokantatiedoston polku:', dbPath);```, jotta voitiin tarkistaa, ett√§ database.db polku on sama mit√§ SQL-konsolissa k√§ytetty polku. Testien avulla saatu selville, ett√§ Backend n√§ytt√§√§ olevan yhteydess√§ oikeaan tietokantatiedostoon, mutta taulun rakenne ei p√§ivity lokeihin oikein. Backend antaa virheilmoituksen ```SQLITE_ERROR: table tasks has no column named completed```. 

Testien avulla p√§√§telty, ett√§ ongelmat johtuvat joko tietokannan v√§limuistista tai ett√§ taulu ylikirjoitetaan backendiss√§. Molempia ongelmia yritetty korjata mm. uudelleen luomalla ja pudottamalla taulua, mutta t√§m√§ ei korjannut ongelmaa. Yritetty my√∂s muokata koodia ```CREATE TABLE IF NOT EXISTS tasks``` kohdassa, mutta n√§ill√§k√§√§n yrityksill√§ ei ongelma korjaantunut. Suljettu my√∂s kaikki SQLite tietokantayhteydet ja yritetty k√§ynnist√§√§ uudelleen, jolla pyritty sulkemaan tietokantayhteyden v√§limuistissa mahdollisesti olleet vanhat tiedot.

Useiden testauksien j√§lkeen todettu, ett√§ sovelluksessa toimii halutusti frontendin antamat virheviestit k√§ytt√§j√§lle, sivustolle kirjautuminen ja k√§ytt√§j√§n rekister√∂ityminen sek√§ rekister√∂ityneen k√§ytt√§j√§n lis√§ttyjen teht√§vien muistaminen (aikaisemmassa vaiheessa teht√§vien lis√§√§minen saatiin toimimaan, mutta t√§t√§ ei saatu palautettua). Teht√§vien muokkaaminen ja poistaminen onnistuvat my√∂s halutusti. Toimimattomana ominaisuutena ovat uuden teht√§v√§n lis√§√§minen sek√§ teht√§v√§n tilan muuttaminen "valmiiksi".

JEST TAI CYPRESS KIRJASTOT JOS KERIT√Ñ√ÑN TEHD√Ñ

## 2.8. K√§ytt√∂liittym√§ ja vuorovaikutus ##

K√§ytt√∂liittym√§ on rakennettu Reactilla. 
